<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Cadastro de Serviço</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <style>
        body, html {
            background: url('/public/imagemCadastroServico.png') no-repeat center;
            background-size: cover;
            min-height: 100vh;
            height: 100%;
        }
        .centraliza {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .card {
            padding: 2.2rem 2rem;
            border-radius: 2rem;
            background: #1a212b;
            box-shadow: 0 2px 32px 0 rgba(0,0,0,0.18);
            color: #fff;
            min-width: 350px;
            max-width: 400px;
        }
        .form-label { color: #80FF44; font-weight: 600; }
        .btn-primary { background: #1e90ff; border: none; }
    </style>
</head>
<body>
    <div class="centraliza">
        <div class="card">
            <h2 class="mb-4 text-center">Cadastro de Serviço</h2>
            <form id="servicoForm">
                <div class="mb-3">
                    <label for="nome" class="form-label">Nome do Serviço:</label>
                    <input type="text" class="form-control" id="nome" required>
                </div>
                <div class="mb-3">
                    <label for="descricao" class="form-label">Descrição:</label>
                    <textarea class="form-control" id="descricao" required></textarea>
                </div>
                <div class="mb-3">
                    <label for="precoPadrao" class="form-label">Preço Padrão:</label>
                    <input type="number" step="0.01" min="0" class="form-control" id="precoPadrao" required>
                </div>
                <div class="mb-3">
                    <label for="tempoEstimado" class="form-label">Tempo Estimado (min):</label>
                    <input type="number" min="1" class="form-control" id="tempoEstimado" required>
                </div>
                <div class="mb-3">
                    <label for="categoriaServico" class="form-label">Categoria:</label>
                    <select id="categoriaServico" class="form-control" required>
                        <option value="">Selecione a categoria...</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Ativo?</label>
                    <select class="form-control" id="ativo" required>
                        <option value="true">Sim</option>
                        <option value="false">Não</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary w-100">Cadastrar</button>
                <a href="listagemServicos.html" class="btn btn-link w-100 mt-2">Voltar</a>
            </form>
            <div id="mensagem" class="mt-3 text-center"></div>
        </div>
    </div>
    <script>
        // Carregar categorias no select
        window.onload = function() {
            fetch('http://localhost:8080/api/categorias-servicos')
                .then(res => res.json())
                .then(data => {
                    let select = document.getElementById('categoriaServico');
                    data.forEach(cat => {
                        let option = document.createElement('option');
                        option.value = cat.idCategoriaServicos;
                        option.textContent = cat.nome;
                        select.appendChild(option);
                    });
                })
                .catch(() => {
                    document.getElementById('mensagem').innerHTML =
                        '<span class="text-danger">Erro ao carregar categorias.</span>';
                });
        };

        // Envio do formulário
        document.getElementById('servicoForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const servico = {
                nome: document.getElementById('nome').value,
                descricao: document.getElementById('descricao').value,
                precoPadrao: parseFloat(document.getElementById('precoPadrao').value),
                tempoEstimado: parseInt(document.getElementById('tempoEstimado').value),
                idCategoriaServico: parseInt(document.getElementById('categoriaServico').value),
                ativo: document.getElementById('ativo').value === "true"
            };
            fetch('http://localhost:8080/api/servicos', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(servico)
            })
            .then(response => {
                if (response.ok) {
                    document.getElementById('mensagem').innerHTML =
                        '<span class="text-success">Serviço cadastrado com sucesso!</span>';
                    document.getElementById('servicoForm').reset();
                } else {
                    return response.text().then(txt => { throw new Error(txt); });
                }
            })
            .catch(error => {
                document.getElementById('mensagem').innerHTML =
                    '<span class="text-danger">Erro: ' + error.message + '</span>';
            });
        });
    </script>
</body>
</html>